<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Recircle Cup</title>

    <link rel="apple-touch-icon" sizes="57x57" href="/static/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/static/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/static/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/static/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/static/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/static/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/static/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/static/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/static/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/static/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="/static/custom.css" media="all">
    <link rel="stylesheet" href="/static/layout.css" media="all and (min-width: 33.236em)">
    <!-- 30em + (1.618em * 2) = 33.236em / Eliminates potential of horizontal scrolling in most cases -->

    <!--[if (lt IE 9) & (!IEMobile)]>
    <link rel="stylesheet" href="/static/layout.css" media="all">
    <![endif]-->
    <link href="https://fonts.googleapis.com/css?family=Karla:400,700|Merriweather+Sans|Raleway" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Karla:400,700|Merriweather+Sans|Raleway" rel="stylesheet">
    <script>
        !function() {
            var t;
            if (t = window.driftt = window.drift = window.driftt || [], !t.init) return t.invoked ? void (window.console && console.error && console.error("Drift snippet included twice.")) : (t.invoked = !0,
                    t.methods = [ "identify", "config", "track", "reset", "debug", "show", "ping", "page", "hide", "off", "on" ],
                    t.factory = function(e) {
                        return function() {
                            var n;
                            return n = Array.prototype.slice.call(arguments), n.unshift(e), t.push(n), t;
                        };
                    }, t.methods.forEach(function(e) {
                t[e] = t.factory(e);
            }), t.load = function(t) {
                var e, n, o, i;
                e = 3e5, i = Math.ceil(new Date() / e) * e, o = document.createElement("script"),
                        o.type = "text/javascript", o.async = !0, o.crossorigin = "anonymous", o.src = "https://js.driftt.com/include/" + i + "/" + t + ".js",
                        n = document.getElementsByTagName("script")[0], n.parentNode.insertBefore(o, n);
            });
        }();
        drift.SNIPPET_VERSION = '0.3.1';
        drift.load('3i2nh4v2nv35');
    </script>
    <script type="text/javascript" src="https://cdn.emailjs.com/dist/email.min.js"></script>
    <script type="text/javascript">
        (function(){
            emailjs.init("user_STIZUXa2EcJZW0JbNzJkK");
        })();
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
            crossorigin="anonymous"></script>
</head>

<body id="container">
<header>
    <nav>
        <div class="logo">
            <a href="/"><img src="/static/logoalt.png"/></a>
        </div>
        <div class="nav">
            <a href="/start">Get started</a>
            <a href="/#blog">Blog</a>
            <a class="drift-open-chat">Talk to us</a>
        </div>
    </nav>
</header>

<div id="body">

    <section class="emphasis-background">
        <article>
            <form class="order-form margin-bottom-10" onsubmit="event.preventDefault(); sendForm(this)">
            <div class="col1 compact">
                    <div class="margin-bottom-40">
                        <div class="font-1p25em font-bold margin-bottom-20">
                            Your Cup
                        </div>
                        <div class="margin-bottom-15">
                            <div class="label">Small</div>
                            <input type="number" name="quantity-small" title="Quantity" value="1" class="cup-quantity"
                                   oninput="updateTotal(this)" min="0">
                        </div>
                        <div class="margin-bottom-15">
                            <div class="label">Large</div>
                            <input type="number" name="quantity-large" title="Quantity" value="0" class="cup-quantity"
                                   oninput="updateTotal(this)" min="0">
                        </div>
                        <div class="margin-bottom-15">
                            <div class="quantity-help display-none form-error"></div>
                        </div>
                        <div class="margin-bottom-15">
                            <div class="label">Color</div>
                            <select title="Color" name="color">
                                <option>Pink</option>
                                <option>Blue</option>
                                <option>Purple</option>
                                <option>White</option>
                            </select>
                        </div>
                        <div class="margin-bottom-10">
                            <a href="/which-size" target="_blank">Which size is best for me?</a>
                        </div>
                        <div>
                            <input type="checkbox" class="cup-offer" name="cup-offer" title="Get an extra cup" onchange="addOffer(this)">
                            <span class="cup-offer">Sister Cup Offer</span>
                            <div class="light-grey">
                                Get two cups for Rs. 3000 (50% off the second cup)
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="font-1p25em font-bold margin-bottom-20">
                            Your Details
                        </div>
                        <div class="margin-bottom-15">
                            <div class="label">Name</div>
                            <input type="text" name="name" title="Name" class="customer-name" required>
                        </div>
                        <div class="margin-bottom-15">
                            <div class="label">Address</div>
                            <input type="text" name="address" title="Address" class="customer-address" required>
                        </div>
                        <div class="margin-bottom-15">
                            <div class="label">City</div>
                            <input type="text" name="city" title="City" class="customer-city" required>
                        </div>
                        <div class="margin-bottom-15">
                            <div class="label">Mobile Number</div>
                            <input type="text" name="mobile-number" title="Mobile Number" class="customer-mobile-number" required>
                        </div>
                        <div class="margin-bottom-15">
                            <div class="label">Email (optional)</div>
                            <input type="text" name="email" title="Email" class="customer-email">
                        </div>
                        <div class="margin-bottom-15">
                            <div class="label">Comments (optional)</div>
                            <textarea name="comments" title="Comments" class="customer-comments"></textarea>
                        </div>
                    </div>
            </div>
            <div class="col2 compact">
                <div class="cup-image">
                    <img src="/static/sizes.png"/>
                </div>
                <div class="margin-bottom-20">
                    <a href="https://www.instagram.com/p/Ba3jpVZB_NZ/?taken-by=recircle.life"
                       target="_blank">See all colors</a>
                </div>
                <div class="margin-bottom-40">
                    <div class="font-1p25em font-bold margin-bottom-20">
                        Order Summary
                    </div>
                    <div class="label">Items</div>
                    <div class="order-item">
                        Recircle Cup Small x<span class="order-item-quantity">1</span>
                        <div class="order-item-price">Rs. 2000</div>
                    </div>
                    <div class="order-item display-none">
                        Recircle Cup Large x<span class="order-item-quantity-large">1</span>
                        <div class="order-item-price">Rs. 0</div>
                    </div>
                </div>

                <div class="margin-bottom-40">
                    <div class="font-1p25em font-bold margin-bottom-20">
                        Payment Method
                    </div>
                    <div class="margin-bottom-5">
                        <input type="radio" id="cash" name="radio-group" checked onclick="showHelp(this)">
                        <label for="cash">Cash on delivery</label>
                        <input type="radio" id="transfer" name="radio-group" onclick="showHelp(this)">
                        <label for="transfer" class="margin-left-25">Bank transfer</label>
                    </div>
                    <div class="label payment-help">Pay with cash when your order arrives</div>
                </div>

                <div class="margin-bottom-20">
                    <div class="total-price font-bold font-1p25em margin-bottom-5">
                        Total: <span class="font-bold">Rs. <span class="price">2000</span></span>
                    </div>
                    <div class="label">Free home delivery included</div>
                </div>
                <input type="submit" value="Finish Order" class="finish-order">
            </div>
            </form>
            <div class="clear"></div>
        </article>
    </section>
</div>

<script>
    function getCookie(name) {
        var value = "; " + document.cookie;
        var parts = value.split("; " + name + "=");
        if (parts.length == 2) return parts.pop().split(";").shift();
    }
    var smallCups = (getCookie('small')) ? getCookie('small') : 1;
    var largeCups = (getCookie('large')) ? getCookie('large') : 0;
    var outOfStock = false;
    document.querySelector("input[name='quantity-small']").value = smallCups;
    document.querySelector("input[name='quantity-large']").value = largeCups;
    var url_string = window.location.href;
    var url = new URL(url_string);
    var discount = url.searchParams.get("discount");
    var name = url.searchParams.get("name");
    var email = url.searchParams.get("email");
    if (discount == 'true') {
        discount = true;
    }
    discount = false;
    if (name != 'null') {
        document.querySelector("input[name='name']").value = name
    }
    if (email != 'null') {
        document.querySelector("input[name='email']").value = email
    }
    updateTotal();

    function showHelp(element) {
        if (element.id == 'transfer') {
            document.querySelector('.payment-help').textContent =
                    'Pay to Wasma Imran - 0766-6199-4100-4526 - MCB T Block, DHA 2. Add transaction ID in comments.'
        }
        else {
            document.querySelector('.payment-help').textContent =
                    'Pay with cash when your order arrives'
        }
    }
    function sendForm(e) {
        document.querySelector('.finish-order').value = 'Sending...please wait';
        var order = [];
        var large = parseInt(document.querySelector("input[name='quantity-large']").value) || 0;
        var small = parseInt(document.querySelector("input[name='quantity-small']").value) || 0;
        var color = document.querySelector('select[name="color"]').value;
        var name = document.querySelector('input[name="name"]').value;
        var address = document.querySelector('input[name="address"]').value;
        var city = document.querySelector('input[name="city"]').value;
        var mobile = document.querySelector('input[name="mobile-number"]').value;
        var email = document.querySelector('input[name="email"]').value;
        var comments = document.querySelector('textarea[name="comments"]').value;
        var payment = document.querySelector('input[name="radio-group"]:checked').id;
        if (payment == 'transfer') {
            payment = 'bank transfer'
        }
        var total = document.querySelector('.price').textContent;

        if (small > 1) {
            order.push(small + ' Recircle Cups (Small)')
        }
        else if (small == 1) {
            order.push(small + ' Recircle Cup (Small)')
        }
        if (large > 1) {
            order.push(large + ' Recircle Cups (Large)')
        }
        else if (large == 1) {
            order.push(large + ' Recircle Cup (Large)')
        }

        var data = {
            small: small, large: large, color: color, name: name, address: address, city: city,
            number: mobile, email: email, comments: comments, payment_type: payment, total: total
        };
        // Send order to API
        $.ajax({
            type: "POST",
            contentType: "application/json; charset=utf-8",
            crossDomain: true,
            url: 'https://recircle-api.herokuapp.com/_add_order',
            data: JSON.stringify({
                data: data
            }),
            success: function (data) {
                requestRunning = false;
                // Send email to admin
                emailjs.send("sendgrid", "template_VmJ5BJNR", {
                    small: small,
                    large: large,
                    color: color,
                    offer: (document.querySelector('input[name="cup-offer"]').checked) ? 'Yes' : 'No',
                    name: name,
                    address: address,
                    city: city,
                    mobile: mobile,
                    email: email,
                    comments: comments,
                    payment: payment,
                    total: total
                })
                        .then(function (response) {
                            if (!email) {
                                // Redirect if no email provided by user
                                window.location.href = '/thankyou';
                            }
                        }, function (err) {
                            console.log("FAILED. error=", err);
                        });

                // Send email to user if email entered
                if (email) {
                    emailjs.send("sendgrid", "user_email", {
                        order: order.join(', '),
                        color: color,
                        name: name,
                        address: address,
                        city: city,
                        mobile: mobile,
                        email: email,
                        comments: comments,
                        payment: payment,
                        total: total
                    })
                            .then(function (response) {
                                window.location.href = '/thankyou';
                            }, function (err) {
                                console.log("FAILED. error=", err);
                            });
                }
            },
            error: function(data) {
                // Send email to admin
                emailjs.send("sendgrid", "template_VmJ5BJNR", {
                    small: small,
                    large: large,
                    color: color,
                    offer: (document.querySelector('input[name="cup-offer"]').checked) ? 'Yes' : 'No',
                    name: name,
                    address: address,
                    city: city,
                    mobile: mobile,
                    email: email,
                    comments: comments,
                    payment: payment,
                    total: total
                })
                        .then(function (response) {
                            if (!email) {
                                // Redirect if no email provided by user
                                window.location.href = '/thankyou';
                            }
                        }, function (err) {
                            console.log("FAILED. error=", err);
                        });

                // Send email to user if email entered
                if (email) {
                    emailjs.send("sendgrid", "user_email", {
                        order: order.join(', '),
                        color: color,
                        name: name,
                        address: address,
                        city: city,
                        mobile: mobile,
                        email: email,
                        comments: comments,
                        payment: payment,
                        total: total
                    })
                            .then(function (response) {
                                window.location.href = '/thankyou';
                            }, function (err) {
                                console.log("FAILED. error=", err);
                            });
                }
            }
            dataType: "json"
        });
    }

    function updateTotal(element) {
        var large = parseInt(document.querySelector("input[name='quantity-large']").value) || 0;
        var small = parseInt(document.querySelector("input[name='quantity-small']").value) || 0;

        document.querySelector(".order-item-quantity").textContent = small;
        document.querySelector(".order-item-quantity").nextElementSibling.textContent = 'Rs. ' + (small * 2000).toString();

        document.querySelector(".order-item-quantity-large").parentNode.classList.remove('display-none');
        document.querySelector(".order-item-quantity-large").textContent = large;
        document.querySelector(".order-item-quantity-large").nextElementSibling.textContent = 'Rs. ' + (large * 2000).toString();

        // Show large cup unavailability and add discount
        if (outOfStock) {
            if (large > 0) {
                document.querySelector(".quantity-help").classList.remove('display-none');
            }
            else {
                document.querySelector(".quantity-help").classList.add('display-none');
            }
        }

        var total = small + large;
        var totalPrice;
        if (total == 2) {
            totalPrice = 3000;
            if (discount) {
                totalPrice *= 0.9;
                document.querySelector(".price").textContent = totalPrice.toString() + " (10% Off + Save Rs. 900)";
            }
            else {
                document.querySelector(".price").textContent = totalPrice.toString() + " (Save Rs. 1000)";
            }
            document.querySelector(".cup-offer").checked = true;
        }
        else {
            totalPrice = total * 2000;
            if (discount) {
                totalPrice *= 0.9;
                document.querySelector(".price").textContent = totalPrice.toString() + " (10% Off)";
            }
            else {
                document.querySelector(".price").textContent = totalPrice.toString();
            }
            document.querySelector(".cup-offer").checked = false;
        }
    }
    function addOffer(element) {
        var totalPrice;
        if (element.checked) {
            totalPrice = 3000;
            if (discount) {
                totalPrice *= 0.9;
                document.querySelector(".price").textContent = totalPrice.toString() + " (10% Off + Save Rs. 900)";
            }
            else {
                document.querySelector(".price").textContent = totalPrice.toString() + " (Save Rs. 1000)";
            }
            document.querySelector(".cup-quantity").value = 2;
            document.querySelector("input[name='quantity-large']").value = 0;
        }
        else {
            totalPrice = 2000;
            if (discount) {
                totalPrice *= 0.9;
                document.querySelector(".price").textContent = totalPrice.toString() + " (10% Off)";
            }
            else {
                document.querySelector(".price").textContent = totalPrice.toString();
            }
            document.querySelector(".cup-quantity").value = 1;
        }
        var large = parseInt(document.querySelector("input[name='quantity-large']").value) || 0;
        var small = parseInt(document.querySelector("input[name='quantity-small']").value) || 0;
        document.querySelector(".order-item-quantity").textContent = small;
        document.querySelector(".order-item-quantity").nextElementSibling.textContent = 'Rs. ' + (small * 2000).toString();

        document.querySelector(".order-item-quantity-large").parentNode.classList.remove('display-none');
        document.querySelector(".order-item-quantity-large").textContent = large;
        document.querySelector(".order-item-quantity-large").nextElementSibling.textContent = 'Rs. ' +  (large * 2000).toString();

    }
    (function() {
        var DRIFT_CHAT_SELECTOR = '.drift-open-chat';
        function ready(fn) {
            if (document.readyState != 'loading') {
                fn();
            } else if (document.addEventListener) {
                document.addEventListener('DOMContentLoaded', fn);
            } else {
                document.attachEvent('onreadystatechange', function() {
                    if (document.readyState != 'loading')
                        fn();
                });
            }
        }
        /* http://youmightnotneedjquery.com/#each */
        function forEachElement(selector, fn) {
            var elements = document.querySelectorAll(selector);
            for (var i = 0; i < elements.length; i++)
                fn(elements[i], i);
        }
        function openSidebar(driftApi, event) {
            event.preventDefault();
            driftApi.sidebar.open();
            return false;
        }
        ready(function() {
            drift.on('ready', function(api) {
                var handleClick = openSidebar.bind(this, api)
                forEachElement(DRIFT_CHAT_SELECTOR, function(el) {
                    el.addEventListener('click', handleClick);
                });
            });
        });
    })();
</script>
</body>

<div id="footer">
    <a href="mailto:contact@recircle.life">contact@recircle.life</a>
    <p class="center">
        Copyright Recircle Cup 2017
    </p>
</div>
</html>